<!-- Header c·∫≠p nh·∫≠t -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter Movies</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="FlameOnePage freebie theme for web startups by FairTech SEO." name="description" />
    <meta content="FairTech" name="author" />
    <link href="http://fonts.googleapis.com/css?family=Hind:300,400,500,600,700" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="/static/home/vendor/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/home/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/home/css/animate.css" rel="stylesheet">
    <link href="/static/home/vendor/swiper/css/swiper.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/home/css/layout.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/home/css/layout.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />

    <style>
        .user-password {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #888;
        }

        .toggle-password:hover {
            color: #fff;
        }

        #countryDropdown:focus,
        #countryDropdown:active,
        #countryDropdown.open,
        #userDropdown:focus,
        #userDropdown:active,
        #userDropdown.open {
            background-color: transparent !important;
            /* Lo·∫°i b·ªè n·ªÅn tr·∫Øng */
            color: red !important;
            /* Gi·ªØ m√†u ch·ªØ ƒë·ªè */
        }

        .dropdown-menu {
            background: #141414de !important;
            /* ƒê·ªïi m√†u n·ªÅn menu dropdown */
        }

        .dropdown-menu a {
            color: white !important;
            /* Gi·ªØ m√†u ch·ªØ tr·∫Øng */
            text-shadow: 1px 1px 2px black, -1px -1px 2px black;
            /* T·∫°o vi·ªÅn ch·ªØ m√†u ƒëen */
        }

        .left-image {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 50%;
            /* ƒêi·ªÅu ch·ªânh ƒë·ªÉ ·∫£nh r·ªông 50% m√†n h√¨nh */
            background: url('/static/home/img/thumb.jpg') center/cover no-repeat;
        }

        .form-container {
            width: 50%;
            /* Ph·∫ßn ch·ª©a form chi·∫øm 50% */
            margin-left: auto;
            /* ƒê·∫©y form v·ªÅ b√™n ph·∫£i */
            padding: 40px;
        }

        .form-control {
            background-color: #1e253a;
            border: none;
            color: white;

            border-radius: 8px;
        }

        .form-control:focus {
            background-color: #2c344b;
            outline: none;
            box-shadow: none;
        }

        .btn-warning {
            background-color: #fbc531;
            border: none;
            color: #121829;
            font-weight: bold;
            border-radius: 8px;
            padding: 12px;
        }

        .btn-warning:hover {
            background-color: #e1a825;
        }

        .search-box {
            display: flex;
            align-items: center;

        }

        #searchInput {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            outline: none;
            width: 350px;
            transition: width 0.3s ease-in-out;
            background-color: #1e253a00;
            height: 40px;
        }

        #searchInput:focus {
            width: 400px;
        }

        #searchInput::placeholder {
            color: white;
            opacity: 1;
            /* ƒê·∫£m b·∫£o m√†u tr·∫Øng hi·ªÉn th·ªã r√µ */
        }

        #searchButton {
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 5px;
        }

        #searchButton i {
            font-size: 18px;
        }

        .dropdown-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* Chia th√†nh 3 c·ªôt */
            gap: 10px;
            /* Kho·∫£ng c√°ch gi·ªØa c√°c m·ª•c */
            padding: 10px;
            /* Th√™m kho·∫£ng c√°ch b√™n trong */
            background-color: rgba(0, 0, 0, 0.8);
            /* N·ªÅn dropdown */
            border-radius: 8px;
            /* Bo g√≥c */
        }

        .dropdown-grid a {
            color: white !important;
            /* M√†u ch·ªØ */
            text-align: left;
            /* CƒÉn tr√°i */
            padding: 5px 10px;
            /* Kho·∫£ng c√°ch b√™n trong */
            text-decoration: none;
            /* Lo·∫°i b·ªè g·∫°ch ch√¢n */
        }

        .dropdown-grid a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            /* Hi·ªáu ·ª©ng hover */
            border-radius: 4px;
            /* Bo g√≥c khi hover */
        }

        .dropdown-menu {
            display: none;
            /* ·∫®n m·∫∑c ƒë·ªãnh */
        }

        .dropdown.open .dropdown-menu {
            display: grid;
            /* Hi·ªÉn th·ªã khi m·ªü */
        }

        .search-modal {
            background: #1b1b1bf6;
            border-radius: 8px;
            padding: 15px;
            width: 100%;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            max-height: 570px;

            scroll-behavior: auto;
        }

        /* Thi·∫øt l·∫≠p thanh cu·ªôn */
        .search-modal::-webkit-scrollbar {
            width: 8px;
            /* ƒê·ªô r·ªông c·ªßa thanh cu·ªôn */
        }

        /* M√†u n·ªÅn thanh cu·ªôn */
        .search-modal::-webkit-scrollbar-track {
            background: #333;
            /* M√†u n·ªÅn */
            border-radius: 4px;
        }

        /* M√†u c·ªßa thanh k√©o */
        .search-modal::-webkit-scrollbar-thumb {
            background: #666;
            /* M√†u thanh k√©o */
            border-radius: 4px;
        }

        /* Hover v√†o thanh k√©o */
        .search-modal::-webkit-scrollbar-thumb:hover {
            background: #888;
        }


        /* Ti√™u ƒë·ªÅ nh√≥m phim */
        .group-title {
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 10px;
        }

        /* Danh s√°ch phim */
        .group-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* M·ªói item phim */
        .h-item.s-item {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: #ccc;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .h-item.s-item .info-line {
            align-items: flex-end;
        }

        .h-item.s-item:hover {
            background: #333;
        }

        .h-item.s-item:hover .alias-title {
            color: #d286e4;
        }

        /* ·∫¢nh poster phim */
        .v-thumb-s {
            width: 75px;
            height: 100px;

            margin-right: 10px;
        }

        .v-thumbnail img {
            width: 100%;
            height: 100%;
            border-radius: 4px;
            object-fit: cover;
            max-height: 100px !important;
        }

        .info {
            height: 100px;
        }



        /* T√™n phim */
        .item-title {
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            margin: 0;
            white-space: nowrap;
            /* Kh√¥ng cho xu·ªëng h√†ng */
            overflow: hidden;
            /* ·∫®n ph·∫ßn d∆∞ */
            text-overflow: ellipsis;
            /* Th√™m d·∫•u "..." khi b·ªã c·∫Øt */
            max-width: 330px;
            /* ƒê·∫£m b·∫£o kh√¥ng tr√†n container */
        }

        /* T√™n ti·∫øng Anh ho·∫∑c t√™n g·ªëc */
        .alias-title {
            font-size: 10px;
            color: #bbb;
            margin-top: 10px;
            white-space: nowrap;
            /* Kh√¥ng cho xu·ªëng h√†ng */
            overflow: hidden;
            /* ·∫®n ph·∫ßn d∆∞ */
            text-overflow: ellipsis;
            /* Th√™m d·∫•u "..." khi b·ªã c·∫Øt */
            max-width: 330px;
            /* ƒê·∫£m b·∫£o kh√¥ng tr√†n container */
        }

        /* H√†ng th√¥ng tin t·∫≠p, ph·∫ßn */
        .info-line {
            display: flex;

            gap: 3px;

        }

        .info-line h6 {
            font-size: 9px;
            color: #bbb;
        }

        /* Th·∫ª nh·ªè cho t·∫≠p, ph·∫ßn */
        .tag-small {
            background: #ff9800;
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
<style>
    /* CSS cho hi·ªáu ·ª©ng loading */
    #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #141414;
        display: flex;
        flex-direction: column; /* Thay ƒë·ªïi h∆∞·ªõng flex th√†nh c·ªôt */
        align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
        justify-content: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
        z-index: 9999;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    #loading-screen h1 {
        position: absolute;
        height: 40px;
        margin: auto;
        top: 220px;
        left: 0;
        right: 0;
        bottom: 0;
        text-transform: uppercase;
        text-align: center;
        letter-spacing: 0.1em;
        font-size: 14px;
        font-weight: lighter;
        color: white;
        span {
            display: none;
        }
        &::after {
            animation: txt 5s infinite;
            content: "";
        }
    }

    @keyframes rt {
        100% {transform: rotate(360deg);}
    }

    @keyframes cw {
        0% {
            width: 0;
            height: 0;
        }
        75% {
            width: 40px;
            height: 40px;
        }
        100% {
            width: 0;
            height: 0;
        }
    }

    @keyframes txt {
        0% {
            content: "LOADING.";
        }
        50% {
            content: "LOADING..";
        }
        100% {
            content: "LOADING...";
        }
    }
</style>
</head>

<header class="header navbar-fixed-top">
    <nav class="navbar" role="navigation">
        <div class="container-fluid">
            <div class="menu-container js_nav-item">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="toggle-icon"></span>
                </button>
                <div class="logo">
                    <a class="logo-wrap" href="/phimmoi">
                        <img class="logo-img logo-img-main" src="/static/home/img/logo.png" alt="FlameOnePage Logo">
                        <img class="logo-img logo-img-active" src="/static/home/img/logo-white.png"
                            alt="FlameOnePage Dark Logo">
                    </a>
                </div>
            </div>

            <div class="collapse navbar-collapse nav-collapse">
                <div class="menu-container">
                    <ul class="nav navbar-nav navbar-nav-right">
                        <!-- √î nh·∫≠p t√¨m ki·∫øm -->
                        <li class="js_nav-item nav-item">
                            <div class="search-box nav-item-child nav-item-hover">
                                <input style="color: d286e4;" type="text" id="searchInput"
                                    placeholder="T√¨m ki·∫øm phim..." />
                                <button id="searchButton"><i class="bi bi-search"></i></button>
                                <div id="searchResults" class="search-results"></div> <!-- K·∫øt qu·∫£ t√¨m ki·∫øm -->
                            </div>
                        </li>

                        <li class="js_nav-item nav-item dropdown">
                            <a class="nav-item-child nav-item-hover dropdown-toggle" href="#" id="countryDropdown"
                                data-toggle="dropdown" aria-expanded="false">Qu·ªëc Gia <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu dropdown-grid" aria-labelledby="countryDropdown"></ul>
                        </li>

                        <li class="js_nav-item nav-item nav-filter"><a class="nav-item-child nav-item-hover"
                                href="">Phim L·∫ª</a></li>
                        <li class="js_nav-item nav-item nav-filter"><a class="nav-item-child nav-item-hover"
                                href="">Phim B·ªô</a></li>

                        <li class="js_nav-item nav-item"><a class="nav-item-child nav-item-hover" href="/filter">L·ªçc
                                phim</a>
                        </li>
                        <li class="js_nav-item nav-item" id="authSection">
                            <!-- JS s·∫Ω thay th·∫ø n·ªôi dung t·∫°i ƒë√¢y -->
                        </li>
                    </ul>
                </div>

            </div>
        </div>
    </nav>

</header>
<div id="loading-screen">
    <img class="logo-img logo-img-main" src="/static/home/img/logo.png" alt="FlameOnePage Logo">

    <div class="spinner"></div>

    <h1><span>LOADING</span></h1>
</div>
<!-- Modal ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
<div id="authModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content position-relative"
            style="background-color: #121829; border-radius: 12px; color: white; overflow: hidden;">

            <!-- N√∫t ƒë√≥ng modal -->
            <button class="btn modal-close position-absolute"
                style="top: 10px; right: 10px; color: white; background: transparent; border: none;">
                <i class="fa-solid fa-times"></i>
            </button>

            <!-- ·∫¢nh n·ªÅn b√™n tr√°i -->
            <div class="left-image"></div>

            <!-- Ph·∫ßn form -->
            <div class="form-container">
                <!-- Form ƒëƒÉng nh·∫≠p -->
                <div id="loginForm">
                    <div class="is-header mb-3 text-center">
                        <h4 class="heading-sm mb-0">ƒêƒÉng nh·∫≠p</h4>
                    </div>
                    <div class="is-body">

                        <p class="mt-2">
                            N·∫øu ch∆∞a c√≥ t√†i kho·∫£n, m·ªùi Huynh ƒê√†i <a style="color: #fbc531;" href="#"
                                id="switchToRegister">ƒêƒÉng k√Ω ngay</a>
                        </p>
                        <form class="v-form">
                            <div class="form-group mb-2">
                                <input class="form-control v-form-control" placeholder="Email" type="text" name="email">
                            </div>
                            <div class="form-group mb-4 user-password">
                                <input class="form-control v-form-control" placeholder="M·∫≠t kh·∫©u" type="password"
                                    name="password">
                                <div class="toggle-password">
                                    <i class="bi bi-eye"></i>
                                </div>
                            </div>
                            <div class="form-group action-btn mt-4 mb-4 d-grid">
                                <button type="submit" class="btn btn-warning btn-block mt-3">ƒêƒÉng nh·∫≠p</button>
                            </div>
                            <div class="form-opt text-center">
                                <a class="small">Qu√™n m·∫≠t kh·∫©u?</a>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Form ƒëƒÉng k√Ω (·∫©n m·∫∑c ƒë·ªãnh) -->
                <div id="registerForm" style="display: none;">
                    <div class="is-header mb-3 text-center">
                        <h4 class="heading-sm mb-0">ƒêƒÉng k√Ω</h4>
                    </div>
                    <div class="is-body">
                        <p class="mt-2" style="display: none;" id="backToLogin">
                            N·∫øu ƒë√£ c√≥ t√†i kho·∫£n, Huynh ƒê√†i h√£y <a style="color: #fbc531;" href="#">ƒêƒÉng nh·∫≠p t·∫°i ƒë√¢y</a>
                        </p>
                        <form class="v-form">
                            <div class="form-group mb-2">
                                <input class="form-control v-form-control" placeholder="T√™n hi·ªÉn th·ªã" type="text"
                                    name="displayName">
                            </div>
                            <div class="form-group mb-2">
                                <input class="form-control v-form-control" placeholder="Email" type="text" name="email">
                            </div>
                            <div class="form-group mb-2 user-password">
                                <input class="form-control v-form-control" placeholder="M·∫≠t kh·∫©u" type="password"
                                    name="password">
                                <div class="toggle-password">
                                    <i class="bi bi-eye"></i>
                                </div>
                            </div>
                            <div class="form-group mb-4 user-password">
                                <input class="form-control v-form-control" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u"
                                    type="password" name="confirmPassword">
                                <div class="toggle-password">
                                    <i class="bi bi-eye"></i>
                                </div>
                            </div>
                            <div class="form-group action-btn mt-4 mb-4 d-grid">
                                <button type="submit" class="btn btn-warning btn-block mt-3">ƒêƒÉng k√Ω</button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>



<script>
    // ·∫®n hi·ªáu ·ª©ng loading sau khi trang t·∫£i xong
    window.addEventListener("load", function() {
        setTimeout(() => {
            document.getElementById("loading-screen").classList.add("hidden");
        }, 500);
    });
    </script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        checkAuthStatus();

        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const switchToRegister = document.getElementById("switchToRegister");
        const backToLogin = document.getElementById("backToLogin");
        const countryDropdown = document.getElementById('countryDropdown');
        const dropdownMenu = document.querySelector('#countryDropdown + .dropdown-menu');
        const searchInput = document.getElementById("searchInput");
        const searchResults = document.getElementById("searchResults");
        let searchTimeout;
        document.querySelectorAll('.nav-filter a').forEach(item => {
            item.addEventListener('click', function (event) {
                event.preventDefault(); // NgƒÉn ch·∫∑n load l·∫°i trang m·∫∑c ƒë·ªãnh

                let params = new URLSearchParams(window.location.search);

                if (this.textContent.trim() === 'Phim L·∫ª') {
                    params.set('types', 'single');
                } else if (this.textContent.trim() === 'Phim B·ªô') {
                    params.set('types', 'series');
                } else if (this.closest('.js_nav-item').classList.contains('dropdown')) {
                    params.set('country', this.dataset.id);
                }

                // ƒêi·ªÅu h∆∞·ªõng sang trang l·ªçc v·ªõi c√°c tham s·ªë c·∫≠p nh·∫≠t
                window.location.href = `/filter?${params.toString()}`;
            });
        });


        countryDropdown.addEventListener('click', function (event) {
            event.preventDefault();
            dropdownMenu.style.display = dropdownMenu.style.display === 'grid' ? 'none' : 'grid';
        });

        // ƒê√≥ng dropdown khi click ra ngo√†i
        document.addEventListener('click', function (event) {
            if (!countryDropdown.contains(event.target) && !dropdownMenu.contains(event.target)) {
                dropdownMenu.style.display = 'none';
            }
        });

        document.getElementById('searchButton').addEventListener('click', function () {
            const searchInput = document.getElementById('searchInput').value.trim();
            if (searchInput) {
                let params = new URLSearchParams(window.location.search);
                params.set('keyword', searchInput);
                window.location.href = `/filter?${params.toString()}`;
            }
        });

        fetch('/api/movies/filters')
            .then(response => response.json())
            .then(data => {
                if (data.countries) {
                    const countryDropdownMenu = document.querySelector('#countryDropdown + .dropdown-menu');
                    data.countries.forEach(country => {
                        const countryItem = document.createElement('li');
                        countryItem.innerHTML = `<a class="dropdown-item" href="/filter?country=${country.slug}" data-id="${country.slug}">${country.name}</a>`;
                        countryDropdownMenu.appendChild(countryItem);
                    });
                }
            })
            .catch(error => console.error('Error fetching countries:', error));

        // Cho ph√©p t√¨m ki·∫øm b·∫±ng c√°ch nh·∫•n "Enter"
        document.getElementById('searchInput').addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                document.getElementById('searchButton').click();
            }
        });


        // X·ª≠ l√Ω s·ª± ki·ªán nh·∫≠p v√†o √¥ t√¨m ki·∫øm (Live Search)
        searchInput.addEventListener("input", function () {
            const keyword = searchInput.value.trim();

            if (keyword.length < 2) {
                searchResults.style.display = "none";
                return;
            }

            fetch(`/api/movies/search?keyword=${encodeURIComponent(keyword)}`)
                .then(response => response.json())
                .then(data => {
                    console.log("D·ªØ li·ªáu API tr·∫£ v·ªÅ:", data);

                    searchResults.innerHTML = ""; // X√≥a k·∫øt qu·∫£ c≈© tr∆∞·ªõc khi th√™m m·ªõi

                    if (!data.movies || !Array.isArray(data.movies)) {
                        console.error("D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá:", data);
                        searchResults.innerHTML = `<div class="no-result">L·ªói d·ªØ li·ªáu API</div>`;
                        return;
                    }

                    if (data.movies.length === 0) {
                        searchResults.innerHTML = `<div class="no-result">Kh√¥ng t√¨m th·∫•y phim</div>`;
                    } else {
                        const searchModal = document.createElement("div");
                        searchModal.classList.add("search-modal");

                        const group = document.createElement("div");
                        group.classList.add("show-group", "effect-fade-in");

                        const title = document.createElement("div");
                        title.classList.add("group-title");
                        title.textContent = "Danh s√°ch phim";

                        const list = document.createElement("div");
                        list.classList.add("group-list");

                        data.movies.forEach(movie => {
                            const item = document.createElement("a");
                            item.classList.add("h-item", "s-item");
                            item.href = `/phim/${movie.slug}`;
                            item.innerHTML = `
                        <div class="v-thumb-s">
                            <div class="v-thumbnail">
                                <img src="${movie.thumb_url}" alt="${movie.name}">
                            </div>
                        </div>
                        <div class="info">
                            <h4 class="item-title lim-2">${movie.name}</h4>
                            <h6 class="alias-title mb-2 lim-1">${movie.origin_name || ""}</h6>
                            <div class="info-line">
                                ${movie.quality ? `<h6>${movie.quality}</h6>` : ""}
                                ${movie.year ? `<h6> ‚Ä¢ ${movie.year}</h6>` : ""}
                                ${movie.episode_current ? `<h6> ‚Ä¢ ${movie.episode_current}</h6>` : ""}
                            </div>
                        </div>
                    `;
                            list.appendChild(item);
                        });

                        group.appendChild(title);
                        group.appendChild(list);
                        searchModal.appendChild(group);
                        searchResults.appendChild(searchModal);
                    }

                    searchResults.style.display = "block";
                })
                .catch(error => console.error("L·ªói t√¨m ki·∫øm:", error));
        });

        // X·ª≠ l√Ω s·ª± ki·ªán click ra ngo√†i ƒë·ªÉ ·∫©n k·∫øt qu·∫£ t√¨m ki·∫øm
        document.addEventListener("click", function (e) {
            if (!searchResults.contains(e.target) && e.target !== searchInput) {
                searchResults.style.display = "none";
            }
        });



        // Khi click v√†o input, ch·ªâ hi·ªÉn th·ªã n·∫øu c√≥ k·∫øt qu·∫£
        searchInput.addEventListener("focus", function () {
            if (searchResults.innerHTML.trim() !== "") {
                searchResults.style.display = "block";
            }
        });


        // Chuy·ªÉn sang form ƒëƒÉng k√Ω
        switchToRegister.addEventListener("click", function (event) {
            event.preventDefault();
            loginForm.style.display = "none";
            registerForm.style.display = "block";
            backToLogin.style.display = "block";
        });

        // Chuy·ªÉn v·ªÅ form ƒëƒÉng nh·∫≠p
        backToLogin.addEventListener("click", function (event) {
            event.preventDefault();
            registerForm.style.display = "none";
            loginForm.style.display = "block";
            backToLogin.style.display = "none";
        });

        // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        function showMessage(form, message, isSuccess = false) {
            let messageBox = form.querySelector(".form-message");
            if (!messageBox) {
                messageBox = document.createElement("div");
                messageBox.className = "form-message mt-3 text-center";
                form.appendChild(messageBox);
            }
            messageBox.innerHTML = message;
            messageBox.style.color = isSuccess ? "green" : "red";
        }

        // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        document.querySelector("#loginForm form").addEventListener("submit", async function (e) {
            e.preventDefault();
            const email = this.querySelector("[name='email']").value;
            const password = this.querySelector("[name='password']").value;

            try {
                const response = await fetch("/api/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem("token", data.token);
                    localStorage.setItem("display_name", data.display_name);
                    localStorage.setItem("role_id", data.role_id);

                    // C·∫≠p nh·∫≠t giao di·ªán m√† kh√¥ng c·∫ßn reload
                    checkAuthStatus();

                    // ƒê√≥ng modal sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng
                    // üõ†Ô∏è ·∫®n modal ƒëƒÉng nh·∫≠p ƒë√∫ng c√°ch
                    $('#authModal').modal('hide'); // ƒê√≥ng modal Bootstrap

                    showMessage(this, "ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", true);
                } else {
                    showMessage(this, data.message);
                }
            } catch (error) {
                showMessage(this, "L·ªói k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng th·ª≠ l·∫°i.");
                console.error("L·ªói ƒëƒÉng nh·∫≠p:", error);
            }
        });

        // X·ª≠ l√Ω ƒëƒÉng k√Ω
        document.querySelector("#registerForm form").addEventListener("submit", async function (e) {
            e.preventDefault();
            const display_name = this.querySelector("[name='displayName']").value;
            const email = this.querySelector("[name='email']").value;
            const password = this.querySelector("[name='password']").value;
            const confirmPassword = this.querySelector("[name='confirmPassword']").value;

            if (password !== confirmPassword) {
                showMessage(this, "M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!");
                return;
            }

            try {
                const response = await fetch("/api/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, display_name, password, confirmPassword })
                });

                const data = await response.json();
                if (response.ok) {
                    showMessage(this, "ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.", true);
                    setTimeout(() => document.getElementById("backToLogin").click(), 1500);
                } else {
                    showMessage(this, data.message);
                }
            } catch (error) {
                showMessage(this, "L·ªói k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng th·ª≠ l·∫°i.");
                console.error("L·ªói ƒëƒÉng k√Ω:", error);
            }
        });

        // Hi·ªÉn th·ªã / ·∫®n m·∫≠t kh·∫©u
        document.querySelectorAll(".toggle-password").forEach(toggle => {
            toggle.addEventListener("click", function () {
                let input = this.previousElementSibling;
                if (input.type === "password") {
                    input.type = "text";
                    this.innerHTML = '<i class="bi bi-eye-slash"></i>';
                } else {
                    input.type = "password";
                    this.innerHTML = '<i class="bi bi-eye"></i>';
                }
            });
        });

        function checkAuthStatus() {
            const display_name = localStorage.getItem("display_name");
            const token = localStorage.getItem("token");
            const authSection = document.getElementById("authSection");

            if (!authSection) return; // ƒê·∫£m b·∫£o ph·∫ßn t·ª≠ t·ªìn t·∫°i tr∆∞·ªõc khi c·∫≠p nh·∫≠t

            if (display_name && token) {
                // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p, hi·ªÉn th·ªã dropdown
                authSection.innerHTML = `
                    <a class="nav-item-child nav-item-hover dropdown-toggle" href="#" id="userDropdown" data-toggle="dropdown">
                        ${display_name} <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-right" data-bs-popper>
                        <li><a href="/profile">Profile</a></li>
                        <li><a href="#" id="logoutBtn">ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                `;

                // G√°n s·ª± ki·ªán ƒëƒÉng xu·∫•t ngay l·∫≠p t·ª©c
                document.getElementById("logoutBtn").addEventListener("click", logout);
            } else {
                // N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p, hi·ªÉn th·ªã n√∫t ƒëƒÉng nh·∫≠p
                authSection.innerHTML = `
                    <li class="js_nav-item nav-item">
                        <a class="nav-item-child nav-item-hover" href="#" data-toggle="modal" data-target="#authModal">Th√†nh vi√™n</a>
                    </li>
                `;
            }
        }

        // X·ª≠ l√Ω ƒëƒÉng xu·∫•t
        async function logout() {
            try {
                await fetch("/logout", { method: "POST" });
                localStorage.removeItem("token");
                localStorage.removeItem("display_name");
                localStorage.removeItem("role_id");

                checkAuthStatus(); // C·∫≠p nh·∫≠t giao di·ªán
            } catch (error) {
                console.error("L·ªói ƒëƒÉng xu·∫•t:", error);
            }
        }
    });
</script>